# lobby-game-bridge 設計書

## 概要
マルチプレイヤーゲームにおける「ロビー部屋管理」と「ゲームセッション作成」を疎結合に橋渡しするアーキテクチャパターン。部屋の作成→待機→プレイヤー集合→ゲーム自動開始→リアルタイム通知の全ライフサイクルをカバーする。STMによるスレッドセーフな部屋状態遷移、GameCreatorコールバックによるモジュール間循環依存の回避、WebSocketによるロビーのリアルタイム更新を含む。

## ユースケース
- マルチプレイヤーゲームにロビー機能を追加する際のバックエンド設計
- 部屋(Room)のライフサイクル管理とゲームセッション作成の接続
- WebSocketによるリアルタイムなロビー状態更新（部屋一覧、対局開始通知）
- フロントエンドのホスト待機UI→ゲーム画面への自動遷移
- ロビーモジュールとゲームモジュール間の循環依存を回避する設計

## 提案者
足軽1号

## 提案理由
neo_shogiプロジェクトでWebSocket対戦機能を実装した際、ロビー→ゲーム遷移のパターンがマルチプレイヤーゲーム共通の課題であると判断。特にGameCreatorコールバックによる循環依存回避は、Haskell以外の言語（TypeScript, Rust等）でも適用可能な汎用パターン。

## 承認
- 承認者: 殿（上様）
- 承認日: 2026-02-08
- cmd_082 にて承認

## 関連スキル
- websocket-game-sync: WebSocket接続管理とゲーム状態のbroadcast（ゲーム中の同期に焦点）
- haskell-servant-tvar-api: Servant + TVar のREST APIスキャフォールド
- game-timer-system: ゲームタイマー管理

## 差別化
- **websocket-game-sync** は「ゲーム中」のリアルタイム同期（手の適用→broadcast）に焦点
- **lobby-game-bridge** は「ゲーム前」のロビー管理→ゲーム作成の橋渡しに焦点
- 両スキルは補完関係にあり、組み合わせて使用することでマルチプレイヤー機能の全体をカバーする
